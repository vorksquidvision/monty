<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Monty Hall — Simulator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
html,body{margin:0;padding:0;background:#0e0f13;color:#e8eaf1;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.wrap{max-width:1100px;margin:14px auto;padding:10px}
.row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
input[type=number]{width:140px;padding:6px 8px;background:#0f1320;color:#fff;border:1px solid #2a3350;border-radius:8px}
button{padding:8px 12px;border-radius:8px;border:0;background:#1d8ffe;color:#fff;font-weight:600;cursor:pointer}
button.secondary{background:#2a3350}
.stat{background:#0f1320;border:1px solid #233055;border-radius:10px;padding:8px 10px;margin-top:8px;display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.cell{text-align:center}
.lab{color:#9daccc;font-size:12px}
.val{font-weight:700}
.chart-wrap{position:relative;margin-top:10px}
canvas.chart{display:block;background:#0b0f1a;border:1px solid #1c2544;border-radius:12px;width:100%;height:auto;aspect-ratio:52/21}
canvas.chart.short{aspect-ratio:52/16}
.legend-panel{position:absolute;right:18px;top:18px;background:rgba(20,26,45,.9);border:1px solid #2a365f;padding:8px 10px;border-radius:10px;font-size:12px}
.key{display:flex;align-items:center;gap:8px;margin-top:6px}
.swatch{width:22px;height:3px;border-radius:2px;display:inline-block}
.small{color:#9daccc}
.tooltip{position:absolute;pointer-events:none;background:#151a2b;border:1px solid #2a3350;padding:8px 10px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.35);font-size:12px;color:#e8eaf1;display:none;max-width:280px;z-index:3}
.tooltip .hd{font-weight:700;margin-bottom:4px}
.tests{margin-top:12px;background:#0f1320;border:1px solid #233055;border-radius:10px;padding:10px}
.tests h3{margin:0 0 6px;font-size:14px;color:#cfe0ff}
.test-pass{color:#6fe9a6;font-weight:700}
.test-fail{color:#ff7aa2;font-weight:700}
@media (max-width:600px){
  .chart-wrap{
    display:flex;
    flex-direction:column;
  }
  .chart-wrap .legend-panel{
    position:static;
    order:-1;
    margin-bottom:8px;
    align-self:flex-start;
  }
}
</style>
</head>
<body>
<div class="wrap">
  <div class="row">
    <label for="iters">Iterations:</label>
    <input id="iters" type="number" min="10" max="100000" step="10" value="1000">
    <button id="run">Run</button>
    <span class="small">Compare <b>Always Switch</b> vs <b>Always Stay</b>. Hover charts for details.</span>
  </div>
  <div class="stat">
    <div class="cell"><div class="lab">Switch — Wins</div><div id="swWins" class="val">–</div></div>
    <div class="cell"><div class="lab">Switch — Win %</div><div id="swPct" class="val">–</div></div>
    <div class="cell"><div class="lab">Stay — Wins</div><div id="stWins" class="val">–</div></div>
    <div class="cell"><div class="lab">Stay — Win %</div><div id="stPct" class="val">–</div></div>
  </div>
  <div class="chart-wrap" id="wrap1">
    <canvas id="chart1" class="chart" width="1040" height="420" aria-label="Cumulative win% chart"></canvas>
    <div class="legend-panel">
      <div style="color:#cfe0ff;">Legend</div>
      <div class="key"><span class="swatch" style="background:#5ccfff"></span> Switch — Win %</div>
      <div class="key"><span class="swatch" style="background:#ff7aa2"></span> Stay — Win %</div>
      <div class="small">Dashes: 66.7% & 33.3%</div>
    </div>
    <div id="tooltip1" class="tooltip"></div>
  </div>
  <div class="chart-wrap" id="wrap2">
    <canvas id="chart2" class="chart short" width="1040" height="300" aria-label="Pre-Iteration Outcomes"></canvas>
    <div class="legend-panel">
      <div style="color:#cfe0ff;">Legend</div>
      <div class="key"><span class="swatch" style="background:#5ccfff"></span> Switch — Touching Rows</div>
      <div class="key"><span class="swatch" style="background:#ff7aa2"></span> Stay — Touching Rows</div>
    </div>
    <div id="tooltip2" class="tooltip"></div>
  </div>
  <div class="tests" id="tests">
    <h3>Tests</h3>
    <div id="testResults"></div>
  </div>
</div>
<script>
var COLOR_SWITCH='#5ccfff';
var COLOR_STAY='#ff7aa2';
var COLOR_REF='#6ea9ff';
var COLOR_GRID='#22283a';
var COLOR_TEXT='#8e98ab';
var lastRun=null;
function generateScenarios(n){var list=new Array(n);for(var i=0;i<n;i++){var car=Math.floor(Math.random()*3);var first=Math.floor(Math.random()*3);var host=[0,1,2].filter(function(d){return d!==first&&d!==car});var opened=host[Math.floor(Math.random()*host.length)]||[0,1,2].filter(function(d){return d!==first})[0];list[i]={car:car,first:first,opened:opened}}return list}
function evalStrategy(scenarios,strategy){var n=scenarios.length,wins=0,series=new Array(n),outcomes=new Array(n);for(var i=0;i<n;i++){var s=scenarios[i];var pick=(strategy==='stay')?s.first:[0,1,2].filter(function(d){return d!==s.first&&d!==s.opened})[0];var win=(pick===s.car)?1:0;wins+=win;series[i]=100*wins/(i+1);outcomes[i]=win}return{wins:wins,series:series,outcomes:outcomes}}
function getCanvasMouse(canvas,evt){var rect=canvas.getBoundingClientRect();var scaleX=canvas.width/rect.width;var scaleY=canvas.height/rect.height;var c=evt.touches?evt.touches[0]:evt;return{x:(c.clientX-rect.left)*scaleX,y:(c.clientY-rect.top)*scaleY}}
function drawAxes(ctx,W,H,pL,pR,pT,pB,title,xlab,ylab){ctx.fillStyle=COLOR_TEXT;ctx.font='12px system-ui';ctx.textAlign='center';ctx.fillText(xlab,(W-pL-pR)/2+pL,H-8);ctx.save();ctx.translate(14,(H-pT-pB)/2+pT);ctx.rotate(-Math.PI/2);ctx.fillText(ylab,0,0);ctx.restore();ctx.font='14px system-ui';ctx.fillStyle='#cfe0ff';ctx.fillText(title,(W-pL-pR)/2+pL,pT-12)}
function drawXTicks(ctx,N,pL,pR,pT,pB,W,H){if(N<=1)return;var inW=W-pL-pR;var desired=90;var maxTicks=Math.max(2,Math.floor(inW/desired));var step=Math.max(1,Math.round((N-1)/maxTicks));ctx.textAlign='center';ctx.textBaseline='top';ctx.strokeStyle=COLOR_GRID;ctx.lineWidth=1;ctx.fillStyle=COLOR_TEXT;ctx.font='12px system-ui';for(var i=0;i<N;i+=step){var x=pL+(i/(N-1))*inW;ctx.beginPath();ctx.moveTo(x,pT);ctx.lineTo(x,H-pB);ctx.stroke();ctx.fillText(String(i+1),x,H-pB+8)}}
function drawCumulative(canvas,swSeries,stSeries,hoverIndex){var ctx=canvas.getContext('2d');var W=canvas.width,H=canvas.height;ctx.clearRect(0,0,W,H);var pL=64,pR=18,pT=48,pB=42;var inW=W-pL-pR,inH=H-pT-pB;ctx.strokeStyle=COLOR_GRID;ctx.lineWidth=1;ctx.font='12px system-ui';ctx.fillStyle=COLOR_TEXT;ctx.textAlign='right';ctx.textBaseline='middle';for(var p=0;p<=100;p+=10){var y=pT+(1-p/100)*inH;ctx.beginPath();ctx.moveTo(pL,y);ctx.lineTo(W-pR,y);ctx.stroke();ctx.fillText(p+'%',pL-8,y)}drawXTicks(ctx,swSeries.length,pL,pR,pT,pB,W,H);function line(series,color){ctx.strokeStyle=color;ctx.lineWidth=2;ctx.beginPath();for(var i=0;i<series.length;i++){var x=pL+(i/(series.length-1))*inW;var y=pT+(1-series[i]/100)*inH;if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y)}ctx.stroke()}line(swSeries,COLOR_SWITCH);line(stSeries,COLOR_STAY);ctx.setLineDash([6,6]);ctx.strokeStyle=COLOR_REF;[66.6667,33.3333].forEach(function(p){var y=pT+(1-p/100)*inH;ctx.beginPath();ctx.moveTo(pL,y);ctx.lineTo(W-pR,y);ctx.stroke()});ctx.setLineDash([]);if(hoverIndex!=null){var x=pL+(hoverIndex/(swSeries.length-1))*inW;ctx.strokeStyle='#cfe0ff88';ctx.lineWidth=1.2;ctx.beginPath();ctx.moveTo(x,pT);ctx.lineTo(x,H-pB);ctx.stroke();var y1=pT+(1-swSeries[hoverIndex]/100)*inH;var y2=pT+(1-stSeries[hoverIndex]/100)*inH;ctx.fillStyle=COLOR_SWITCH;ctx.beginPath();ctx.arc(x,y1,3,0,Math.PI*2);ctx.fill();ctx.fillStyle=COLOR_STAY;ctx.beginPath();ctx.arc(x,y2,3,0,Math.PI*2);ctx.fill()}drawAxes(ctx,W,H,pL,pR,pT,pB,'Cumulative Win %','Trials','Win %');return{pL:pL,pR:pR,pT:pT,pB:pB,inW:inW,inH:inH,N:swSeries.length}}
function drawBooleanStreakBlocks(canvas, swOut, stOut, hoverIndex){var ctx=canvas.getContext('2d');var W=canvas.width,H=canvas.height;ctx.clearRect(0,0,W,H);var pL=110,pR=18,pT=48,pB=36;var inW=W-pL-pR,inH=H-pT-pB;var rowH=inH/2;ctx.font='12px system-ui';ctx.fillStyle=COLOR_TEXT;ctx.textAlign='right';ctx.textBaseline='middle';ctx.fillText('Switch',pL-8,pT+rowH/2);ctx.fillText('Stay',pL-8,pT+rowH+rowH/2);var N=swOut.length;drawXTicks(ctx,N,pL,pR,pT,pB,W,H);if(N===0){drawAxes(ctx,W,H,pL,pR,pT,pB,'Pre-Iteration Outcomes (Touching Rows)','Trials','');return{pL:pL,pR:pR,pT:pT,pB:pB,inW:inW,inH:inH,N:0}}var cellW=inW/N;var yTopSw=pT+rowH*0.2;var yTopSt=pT+rowH+rowH*0.2;var h=Math.max(1,Math.floor(rowH*0.6));ctx.fillStyle=COLOR_SWITCH;for(var i=0;i<N;i++){if(swOut[i]){var x=Math.floor(pL+i*cellW);var w=Math.ceil(cellW);ctx.fillRect(x,Math.floor(yTopSw),w,h)}}ctx.fillStyle=COLOR_STAY;for(var j=0;j<N;j++){if(stOut[j]){var x2=Math.floor(pL+j*cellW);var w2=Math.ceil(cellW);ctx.fillRect(x2,Math.floor(yTopSt),w2,h)}}if(hoverIndex!=null){var xh=pL+Math.max(0,Math.min(N-1,hoverIndex))*cellW+cellW/2;ctx.strokeStyle='#cfe0ff88';ctx.lineWidth=1.2;ctx.beginPath();ctx.moveTo(xh,pT);ctx.lineTo(xh,H-pB);ctx.stroke()}drawAxes(ctx,W,H,pL,pR,pT,pB,'Pre-Iteration Outcomes (Touching Rows)','Trials','');return{pL:pL,pR:pR,pT:pT,pB:pB,inW:inW,inH:inH,N:N,cellW:cellW}}
function formatPct(x){return(Math.round(x*1000)/10).toFixed(1)+'%'}
function simulateAndRender(){var n=Math.max(10,Math.min(100000,parseInt(document.getElementById('iters').value||'1000',10)));var sc=generateScenarios(n);var sw=evalStrategy(sc,'switch');var st=evalStrategy(sc,'stay');lastRun={scenarios:sc,sw:sw,st:st};document.getElementById('swWins').textContent=sw.wins.toLocaleString();document.getElementById('stWins').textContent=st.wins.toLocaleString();document.getElementById('swPct').textContent=formatPct(sw.wins/n);document.getElementById('stPct').textContent=formatPct(st.wins/n);drawCumulative(document.getElementById('chart1'),sw.series,st.series,null);drawBooleanStreakBlocks(document.getElementById('chart2'),sw.outcomes,st.outcomes,null)}
function attachHover(wrapId,canvas,drawFn,tipId,getArrays){var wrap=document.getElementById(wrapId);var tip=document.getElementById(tipId);function move(evt){if(!lastRun)return;var arr=getArrays();var meta=drawFn.apply(null,[canvas].concat(arr).concat([null]));var pos=getCanvasMouse(canvas,evt);var N=meta.N;var i;if(N>0){var xRel=pos.x-meta.pL;var colW=meta.cellW||meta.inW/Math.max(1,N);i=Math.floor(xRel/colW)}else{i=0}if(i<0||i>=N){tip.style.display='none';drawFn.apply(null,[canvas].concat(arr).concat([null]));return}drawFn.apply(null,[canvas].concat(arr).concat([i]));var s=lastRun.scenarios[i];var html='<div class="hd">Iteration '+(i+1)+'</div>'+'<div><span style="color:'+COLOR_SWITCH+'">Switch</span> '+(lastRun.sw.outcomes[i]?'WIN':'LOSS')+'</div>'+'<div><span style="color:'+COLOR_STAY+'">Stay</span> '+(lastRun.st.outcomes[i]?'WIN':'LOSS')+'</div>'+'<div class="small">car:'+s.car+' | first:'+s.first+' | opened:'+s.opened+'</div>';if(tipId==='tooltip1'){html='<div class="hd">Iteration '+(i+1)+'</div>'+'<div><span style="color:'+COLOR_SWITCH+'">Switch</span>: '+formatPct(lastRun.sw.series[i]/100)+'</div>'+'<div><span style="color:'+COLOR_STAY+'">Stay</span>: '+formatPct(lastRun.st.series[i]/100)+'</div>'+'<div class="small">car:'+s.car+' | first:'+s.first+' | opened:'+s.opened+'</div>'}tip.innerHTML=html;var rect=wrap.getBoundingClientRect();var c=evt.touches?evt.touches[0]:evt;var tx=c.clientX-rect.left+12;var ty=c.clientY-rect.top+12;tip.style.display='block';tip.style.left=tx+'px';tip.style.top=ty+'px'}function leave(){if(!lastRun)return;var arr=getArrays();drawFn.apply(null,[canvas].concat(arr).concat([null]));tip.style.display='none'}canvas.addEventListener('mousemove',move,{passive:true});canvas.addEventListener('mouseleave',leave,{passive:true});canvas.addEventListener('touchstart',move,{passive:true});canvas.addEventListener('touchmove',move,{passive:true});canvas.addEventListener('touchend',leave,{passive:true})}
function start(){simulateAndRender();attachHover('wrap1',document.getElementById('chart1'),drawCumulative,'tooltip1',function(){return[lastRun.sw.series,lastRun.st.series]});attachHover('wrap2',document.getElementById('chart2'),drawBooleanStreakBlocks,'tooltip2',function(){return[lastRun.sw.outcomes,lastRun.st.outcomes]});runTests()}
function runTests(){var out=[];var s1=[{car:0,first:0,opened:1}];var sw1=evalStrategy(s1,'switch');var st1=evalStrategy(s1,'stay');out.push({n:'Stay wins when first pick is car',pass:sw1[0]===0&&st1[0]===1});var s2=[{car:2,first:0,opened:1}];var sw2=evalStrategy(s2,'switch');var st2=evalStrategy(s2,'stay');out.push({n:'Switch wins when first pick is goat',pass:sw2[0]===1&&st2[0]===0});var trials=3000;var sc=generateScenarios(trials);var sw=evalStrategy(sc,'switch');var st=evalStrategy(sc,'stay');var swp=sw.reduce((a,b)=>a+b,0)/trials;var stp=st.reduce((a,b)=>a+b,0)/trials;out.push({n:'Switch ≈ 2/3',pass:swp>0.60&&swp<0.73});out.push({n:'Stay ≈ 1/3',pass:stp>0.27&&stp<0.40});var c=document.getElementById('testResults');c.innerHTML='';for(var i=0;i<out.length;i++){var d=document.createElement('div');d.innerHTML=(out[i].pass?'<span class="test-pass">PASS</span>':'<span class="test-fail">FAIL</span>')+' — '+out[i].n;c.appendChild(d)}}
document.getElementById('run').addEventListener('click',start);
window.addEventListener('load',start)
</script>
</body>
</html>
